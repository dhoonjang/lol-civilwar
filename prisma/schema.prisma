// This is your Prisma schema file,
// learn more about it in the docs: https://pris.ly/d/prisma-schema

generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "mysql"
  url      = env("DATABASE_URL")
  relationMode = "prisma"
}

enum Position {
  TOP
  JUNGLE
  MID
  ADC
  SUPPORT
}

model Summoner {
  id              String @id @default(cuid())

  discordId       String @unique

  name            String
  puuid           String @unique

  position        Position

  members         Member[]
  participants    Participant[]

  createdAt       DateTime @default(now())
  updatedAt       DateTime @updatedAt
}

model Guild {
  id          String @id
  name        String

  members     Member[]

  createdAt   DateTime @default(now())
  updatedAt   DateTime @updatedAt
}

enum Permission {
  OWNER
  ADMIN
  MEMBER
}

model Member {
  id            String @id

  permission    Permission
  guildId       String
  summonerId    String

  guild         Guild @relation(fields: [guildId], references: [id], onDelete: Cascade)
  summoner      Summoner @relation(fields: [summonerId], references: [id], onDelete: Cascade)

  @@unique([guildId, summonerId])
  @@index([guildId])
  @@index([summonerId])
}

enum MatchStatus {
  BATTING
  STARTED
  END
}

model Match {
  id              String @id @default(cuid())
  status          MatchStatus
  createdAt       DateTime @default(now())
  updatedAt       DateTime @updatedAt

  timestamp       DateTime?
  duration        Int?

  participants    Participant[]

  @@unique([id])
}

model Participant {
  id              String @id @default(cuid())
  puuid           String
  matchId         String

  win             Boolean?
  championName    String?
  summonerName    String?
  kills           Int?
  assists         Int?
  deaths          Int?

  match           Match @relation(fields: [matchId], references: [id], onDelete: Cascade)
  summoner        Summoner? @relation(fields: [puuid], references: [puuid], onDelete: Cascade)

  @@unique([matchId, puuid])
  @@index([matchId])
  @@index([puuid])
}